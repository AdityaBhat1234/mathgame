<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Math Balloon Pop — Fun Learning</title>
<style>
  :root{
    --bg:#0f1226;
    --panel:#151837;
    --accent:#6cf0a9;
    --accent2:#ffd166;
    --accent3:#7aa2ff;
    --text:#eef2ff;
    --muted:#a8b0d9;
    --danger:#ff6b6b;
    --good:#3bd36b;
  }
  *{box-sizing:border-box;font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial;}
  body{margin:0;background:radial-gradient(1200px 600px at 20% 0%, #1a1f4d 0%, var(--bg) 55%);color:var(--text);}
  header{
    display:flex;gap:16px;align-items:center;justify-content:space-between;
    padding:18px 24px;border-bottom:1px solid #1f2450;background:linear-gradient(#181c3f,#14173a);
    position:sticky;top:0;z-index:10;
  }
  .brand{display:flex;align-items:center;gap:10px}
  .brand .logo{
    width:34px;height:34px;border-radius:8px;background:conic-gradient(from 190deg, var(--accent3), var(--accent), var(--accent2));
    box-shadow:0 0 18px rgba(124,167,255,.35);
  }
  h1{font-size:18px;margin:0;font-weight:700;letter-spacing:.3px}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  select,button,input[type="checkbox"]+label{
    background:var(--panel);color:var(--text);border:1px solid #283065;border-radius:10px;padding:10px 12px;font-size:14px;
  }
  button{cursor:pointer}
  button.primary{background:linear-gradient(180deg, #2a8a5c, #206a47);border-color:#2a8a5c}
  button.warn{background:linear-gradient(180deg, #9a3640, #7a2c34);border-color:#9a3640}
  .wrap{display:grid;grid-template-columns:320px 1fr;gap:16px;max-width:1200px;margin:18px auto;padding:0 18px}
  @media (max-width:960px){.wrap{grid-template-columns:1fr}}
  .panel{
    background:linear-gradient(180deg, #161942, #101336);
    border:1px solid #232a59;border-radius:16px;padding:16px;box-shadow:0 20px 60px rgba(0,0,0,.25);
  }
  .question{
    font-size:18px;margin-bottom:12px;border-left:4px solid var(--accent);padding-left:10px;color:#dfe6ff;
  }
  .meta{display:flex;gap:12px;flex-wrap:wrap;margin-bottom:8px}
  .meta .tag{padding:6px 10px;border-radius:999px;background:#1c2150;border:1px solid #2b3270;color:#c7cff7;font-size:12px}
  .scorebar{
    height:10px;background:#0d1130;border:1px solid #1e2553;border-radius:999px;overflow:hidden;margin:10px 0 16px;
  }
  .scorebar .fill{height:100%;width:0;background:linear-gradient(90deg, var(--accent), var(--accent3));transition:width .3s}
  .hints{color:var(--muted);font-size:13px;margin-top:6px}
  canvas{width:100%;height:520px;background:radial-gradient(900px 500px at 70% 0%, #20265c 0%, #121536 55%);border-radius:16px;border:1px solid #232a59}
  .status{
    display:flex;gap:8px;justify-content:space-between;align-items:center;margin-top:10px;color:#cdd4ff
  }
  .status .pill{padding:6px 10px;background:#192050;border:1px solid #283065;border-radius:999px;font-size:12px}
  .toast{
    position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
    background:#111433;border:1px solid #2a3163;color:#e7ecff;padding:10px 14px;border-radius:12px;
    box-shadow:0 12px 40px rgba(0,0,0,.4);opacity:0;pointer-events:none;transition:opacity .25s, transform .25s;
  }
  .toast.show{opacity:1;transform:translateX(-50%) translateY(-6px)}
  .explain{
    background:#101336;border:1px dashed #2b3270;border-radius:12px;padding:10px;color:#c8cff9;font-size:13px;margin-top:10px
  }
  .footer-tip{color:#97a0cf;font-size:12px;margin-top:10px}
  .switch{
    display:inline-flex;align-items:center;gap:8px
  }
  .switch input{display:none}
  .switch .track{
    width:42px;height:24px;background:#202657;border-radius:999px;position:relative;border:1px solid #2b3270;
  }
  .switch .thumb{
    position:absolute;top:3px;left:3px;width:18px;height:18px;border-radius:999px;background:#cfd7ff;transition:left .2s;
  }
  .switch input:checked + .track .thumb{left:21px;background:#84f5b8}
</style>
</head>
<body>
  <header>
    <div class="brand">
      <div class="logo"></div>
      <h1>Math Balloon Pop</h1>
    </div>
    <div class="controls">
      <select id="category">
        <option value="basics">Basics (add/subtract/multiply/divide)</option>
        <option value="discounts">Discounts & GST</option>
        <option value="interest">Simple Interest</option>
        <option value="profit">Profit & Margin</option>
      </select>
      <select id="difficulty">
        <option value="easy">Easy</option>
        <option value="medium">Medium</option>
        <option value="hard">Hard</option>
      </select>
      <label class="switch">
        <input type="checkbox" id="explainToggle" />
        <div class="track"><div class="thumb"></div></div>
        <span>Explain</span>
      </label>
      <button class="primary" id="startBtn">Start</button>
      <button id="pauseBtn">Pause</button>
      <button class="warn" id="resetBtn">Reset</button>
    </div>
  </header>

  <div class="wrap">
    <div class="panel">
      <div class="question" id="question">Press Start to begin!</div>
      <div class="meta">
        <div class="tag" id="levelTag">Level 1</div>
        <div class="tag" id="streakTag">Streak: 0</div>
        <div class="tag" id="comboTag">Combo: x1.0</div>
      </div>
      <div class="scorebar"><div class="fill" id="progressFill"></div></div>
      <div class="hints" id="hint">Choose the correct balloon to answer.</div>
      <div class="explain" id="explainBox" style="display:none"></div>
      <div class="footer-tip">Tip: Pop balloons with the correct answer. Build streaks to earn combo points!</div>
    </div>
    <div class="panel">
      <canvas id="game"></canvas>
      <div class="status">
        <div class="pill">Score: <span id="score">0</span></div>
        <div class="pill">Lives: <span id="lives">3</span></div>
        <div class="pill">Time: <span id="timer">00:00</span></div>
        <div class="pill">Questions: <span id="qCount">0</span>/10</div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast">Nice! +10</div>

<script>
(() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');
  const DPR = Math.max(1, Math.floor(window.devicePixelRatio || 1));
  function resize(){
    const rect = canvas.getBoundingClientRect();
    canvas.width = Math.floor(rect.width * DPR);
    canvas.height = Math.floor(rect.height * DPR);
  }
  resize();
  window.addEventListener('resize', resize);

  // UI elements
  const startBtn = document.getElementById('startBtn');
  const pauseBtn = document.getElementById('pauseBtn');
  const resetBtn = document.getElementById('resetBtn');
  const categorySel = document.getElementById('category');
  const difficultySel = document.getElementById('difficulty');
  const questionEl = document.getElementById('question');
  const hintEl = document.getElementById('hint');
  const scoreEl = document.getElementById('score');
  const livesEl = document.getElementById('lives');
  const timerEl = document.getElementById('timer');
  const qCountEl = document.getElementById('qCount');
  const progressFill = document.getElementById('progressFill');
  const streakTag = document.getElementById('streakTag');
  const comboTag = document.getElementById('comboTag');
  const levelTag = document.getElementById('levelTag');
  const toast = document.getElementById('toast');
  const explainToggle = document.getElementById('explainToggle');
  const explainBox = document.getElementById('explainBox');

  // Game state
  let balloons = [];
  let running = false;
  let paused = false;
  let score = 0;
  let lives = 3;
  let startTime = 0;
  let elapsed = 0;
  let questionCount = 0;
  let level = 1;
  let streak = 0;
  let combo = 1.0;
  let currentQuestion = null;
  const MAX_QUESTIONS = 10;

  // Utils
  function rand(min, max){return Math.random()*(max-min)+min}
  function choice(arr){return arr[Math.floor(Math.random()*arr.length)]}
  function clamp(v, a, b){return Math.max(a, Math.min(b, v))}
  function formatTime(ms){
    const s = Math.floor(ms/1000);
    const m = Math.floor(s/60);
    const ss = s % 60;
    return `${String(m).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;
  }

  // Confetti
  let confetti = [];
  function spawnConfetti(x,y,color='#6cf0a9'){
    for(let i=0;i<20;i++){
      confetti.push({
        x, y, vx: rand(-2,2)*DPR, vy: rand(-3,-1)*DPR,
        g: rand(0.05,0.12)*DPR, r: rand(2,4)*DPR,
        a: 1, color
      });
    }
  }
  function drawConfetti(){
    for(let i=confetti.length-1;i>=0;i--){
      const c = confetti[i];
      c.vy += c.g; c.x += c.vx; c.y += c.vy; c.a -= 0.01;
      ctx.globalAlpha = Math.max(0, c.a);
      ctx.fillStyle = c.color;
      ctx.beginPath();
      ctx.arc(c.x, c.y, c.r, 0, Math.PI*2);
      ctx.fill();
      ctx.globalAlpha = 1;
      if(c.a <= 0 || c.y > canvas.height+20) confetti.splice(i,1);
    }
  }

  // Toast
  let toastTimer = null;
  function showToast(text){
    toast.textContent = text;
    toast.classList.add('show');
    clearTimeout(toastTimer);
    toastTimer = setTimeout(()=>toast.classList.remove('show'), 900);
  }

  // Question generators
  function genBasics(diff){
    const ops = diff==='easy' ? ['+','-'] : diff==='medium' ? ['+','-','×'] : ['+','-','×','÷'];
    const op = choice(ops);
    let a,b,ans,explain='';
    if(op==='+'){a=rand(10,60)|0; b=rand(5,40)|0; ans=a+b; explain=`Add the numbers: ${a} + ${b} = ${ans}.`}
    if(op==='-'){a=rand(40,90)|0; b=rand(5,35)|0; ans=a-b; explain=`Subtract: ${a} − ${b} = ${ans}.`}
    if(op==='×'){
      a=choice([6,7,8,9,12,15]); b=choice([3,4,5,6,8]); ans=a*b;
      explain=`Multiply: ${a} × ${b} = ${ans}.`
    }
    if(op==='÷'){
      b=choice([2,3,4,5,6,8,10]); ans=choice([6,7,8,9,12]); a=ans*b;
      explain=`Divide: ${a} ÷ ${b} = ${ans} because ${ans} × ${b} = ${a}.`
    }
    return { text:`Compute: ${a} ${op} ${b} = ?`, answer:ans, explain };
  }

  function genDiscounts(diff){
    const price = (rand(200,2000)|0);
    const off = diff==='easy' ? choice([10,20]) : diff==='medium' ? choice([12,15,18]) : choice([22,25,30]);
    const discounted = Math.round(price * (1 - off/100));
    const gst = diff==='hard' ? 18 : choice([5,12,18]);
    const withGST = Math.round(discounted * (1 + gst/100));
    const mode = choice(['final','discount','gst']);
    let text, ans, explain;
    if(mode==='final'){
      text = `A ₹${price} item has ${off}% off, then GST ${gst}% applied. Payable amount?`;
      ans = withGST;
      explain = `Step 1: Discounted price = ₹${price} × (1 − ${off}%)
= ₹${discounted}.
Step 2: With GST ${gst}% = ₹${discounted} × (1 + ${gst}%)
= ₹${withGST}.`;
    } else if(mode==='discount'){
      text = `₹${price} item with ${off}% discount. What is the final price?`;
      ans = discounted;
      explain = `Final = ₹${price} × (1 − ${off}%)
= ₹${discounted}.`;
    } else {
      text = `₹${discounted} after discount. GST ${gst}% applies. Total payable?`;
      ans = withGST;
      explain = `Total = ₹${discounted} × (1 + ${gst}%)
= ₹${withGST}.`;
    }
    return { text, answer:ans, explain };
  }

  function genInterest(diff){
    const P = (rand(5000,20000)|0);
    const R = diff==='easy' ? choice([5,6,8]) : diff==='medium' ? choice([9,10,12]) : choice([12,14,15]);
    const T = diff==='hard' ? choice([1.5,2,2.5,3]) : choice([1,2,3]);
    const SI = Math.round(P * R/100 * T);
    const A = P + SI;
    const mode = choice(['si','amount']);
    const text = mode==='si'
      ? `Simple interest on ₹${P} at ${R}% for ${T} years?`
      : `Total amount on ₹${P} at ${R}% for ${T} years?`;
    const explain = mode==='si'
      ? `SI = P × R × T / 100
= ₹${P} × ${R}% × ${T}
= ₹${SI}.`
      : `SI = ₹${SI}, Amount = P + SI
= ₹${P} + ₹${SI}
= ₹${A}.`;
    return { text, answer: mode==='si' ? SI : A, explain };
  }

  function genProfit(diff){
    const CP = (rand(200,2000)|0);
    const margin = diff==='easy' ? choice([10,15]) : diff==='medium' ? choice([20,25]) : choice([30,35,40]);
    const SP = Math.round(CP * (1 + margin/100));
    const profit = SP - CP;
    const mode = choice(['sp','profit','margin']);
    let text,ans,explain;
    if(mode==='sp'){
      text = `Cost price ₹${CP}, profit margin ${margin}%. Selling price?`;
      ans = SP;
      explain = `SP = CP × (1 + margin)
= ₹${CP} × (1 + ${margin}%)
= ₹${SP}.`;
    } else if(mode==='profit'){
      text = `CP ₹${CP}, SP ₹${SP}. Profit?`;
      ans = profit;
      explain = `Profit = SP − CP
= ₹${SP} − ₹${CP}
= ₹${profit}.`;
    } else {
      text = `CP ₹${CP}, SP ₹${SP}. Profit percentage?`;
      const pct = Math.round(profit / CP * 100);
      ans = pct;
      explain = `Profit% = (Profit/CP)×100
= (₹${profit}/₹${CP})×100
= ${pct}%.`;
    }
    return { text, answer: ans, explain };
  }

  function makeQuestion(){
    const cat = categorySel.value;
    const diff = difficultySel.value;
    if(cat==='basics') return genBasics(diff);
    if(cat==='discounts') return genDiscounts(diff);
    if(cat==='interest') return genInterest(diff);
    return genProfit(diff);
  }

  // Balloons
  function newRound(){
    balloons = [];
    currentQuestion = makeQuestion();
    questionEl.textContent = currentQuestion.text;
    const correct = currentQuestion.answer;
    const options = new Set([correct]);
    while(options.size < 4){
      let noise = Math.max(1, Math.round(Math.abs(rand(-0.35,0.35))*correct));
      if(correct===0) noise = rand(1,20)|0;
      options.add(correct + choice([-1,1])*noise);
    }
    const arr = Array.from(options);
    arr.sort(()=>Math.random()-0.5);

    for(let i=0;i<arr.length;i++){
      const x = rand(60, canvas.width-60);
      const y = canvas.height + rand(40,140);
      let speedRange;
if (difficultySel.value === 'easy') {
  speedRange = [0.6, 1.2];   // keep as is
} else if (difficultySel.value === 'medium') {
  speedRange = [0.5, 1.0];   // slightly slower
} else if (difficultySel.value === 'hard') {
  speedRange = [0.4, 0.9];   // even slower
}
const speed = rand(speedRange[0], speedRange[1]) * DPR;
      const color = choice(['#7aa2ff','#6cf0a9','#ffd166','#ff9bd4']);
      balloons.push({
        x, y, r: 28*DPR, vx: rand(-0.2,0.2)*DPR, vy: -speed,
        wobble: rand(0.8,1.6), text: String(arr[i]), color, correct: arr[i]===correct,
        alive:true
      });
    }
    qCountEl.textContent = questionCount;
    explainBox.style.display = explainToggle.checked ? 'block' : 'none';
    if(explainToggle.checked){
      explainBox.textContent = currentQuestion.explain;
    } else {
      explainBox.textContent = '';
    }
    hintEl.textContent = 'Pop the balloon with the correct answer.';
  }

  function drawBalloon(b){
    // string
    ctx.strokeStyle = '#8fa1ff';
    ctx.lineWidth = 1.5*DPR;
    ctx.beginPath();
    ctx.moveTo(b.x, b.y+b.r);
    ctx.quadraticCurveTo(b.x+6*DPR, b.y+b.r+16*DPR, b.x, b.y+b.r+32*DPR);
    ctx.stroke();
    // body
    const grad = ctx.createRadialGradient(b.x-b.r*0.3, b.y-b.r*0.3, b.r*0.2, b.x, b.y, b.r);
    grad.addColorStop(0, '#ffffff');
    grad.addColorStop(0.2, b.color);
    grad.addColorStop(1, '#1a1f45');
    ctx.fillStyle = grad;
    ctx.beginPath();
    ctx.ellipse(b.x, b.y, b.r*0.9, b.r, 0, 0, Math.PI*2);
    ctx.fill();
    // gloss
    ctx.globalAlpha = 0.35;
    ctx.fillStyle = '#fff';
    ctx.beginPath();
    ctx.ellipse(b.x-b.r*0.3, b.y-b.r*0.4, b.r*0.25, b.r*0.18, 0, 0, Math.PI*2);
    ctx.fill();
    ctx.globalAlpha = 1;
    // text
    ctx.fillStyle = '#0d1130';
    ctx.font = `${14*DPR}px Inter`;
    const text = b.text.length>6 ? b.text.slice(0,6)+'…' : b.text;
    const m = ctx.measureText(text);
    ctx.fillText(text, b.x - m.width/2, b.y+5*DPR);
  }

  // Game loop
  let lastT = 0;
  function loop(t){
    if(!running){requestAnimationFrame(loop); return;}
    if(paused){lastT = t; requestAnimationFrame(loop); return;}
    const dt = Math.min(32, t - (lastT||t));
    lastT = t;
    elapsed = Date.now() - startTime;
    timerEl.textContent = formatTime(elapsed);

    // clear
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // update balloons
    for(const b of balloons){
      b.y += b.vy;
      b.x += Math.sin(t/500 * b.wobble) * 0.6*DPR + b.vx;
    }

    // draw balloons
    balloons.forEach(drawBalloon);

    // confetti
    drawConfetti();

    // remove off-screen and lose life if missed correct one
    for(let i=balloons.length-1;i>=0;i--){
      const b = balloons[i];
      if(b.y < -b.r){
        // If a correct balloon escaped, penalize
        if(b.correct && b.alive){
          lives = Math.max(0, lives-1);
          livesEl.textContent = lives;
          streak = 0; combo = 1.0;
          updateTags();
          showToast('Missed! -1 life');
        }
        balloons.splice(i,1);
      }
    }

    // next question when none remain
    if(balloons.length===0 && running){
      questionCount++;
      progressFill.style.width = `${clamp(questionCount/MAX_QUESTIONS*100, 0, 100)}%`;
      if(questionCount >= MAX_QUESTIONS){
        endGame(true);
      } else {
        level = 1 + Math.floor(questionCount/3);
        levelTag.textContent = `Level ${level}`;
        newRound();
      }
    }

    requestAnimationFrame(loop);
  }

  function updateTags(){
    streakTag.textContent = `Streak: ${streak}`;
    comboTag.textContent = `Combo: x${combo.toFixed(1)}`;
  }

  function startGame(){
    score = 0; lives = 3; questionCount = 0; level = 1; streak = 0; combo = 1.0;
    running = true; paused = false;
    startTime = Date.now(); progressFill.style.width='0%';
    scoreEl.textContent = score; livesEl.textContent = lives; qCountEl.textContent = 0;
    levelTag.textContent = `Level ${level}`;
    newRound();
    requestAnimationFrame(loop);
  }

  function endGame(won){
    running = false;
    const msg = won ? `Victory! Score ${score}` : `Game Over. Score ${score}`;
    hintEl.textContent = won ? 'Lovely streaks and steady focus—well played!' : 'No worries. Breathe, shake it off, and try again.';
    showToast(msg);
  }

  function resetGame(){
    running = false; paused = false;
    score = 0; lives = 3; questionCount = 0; level = 1; streak = 0; combo = 1.0;
    balloons = []; confetti = [];
    scoreEl.textContent = score; livesEl.textContent = lives; qCountEl.textContent = 0;
    progressFill.style.width='0%'; levelTag.textContent='Level 1';
    questionEl.textContent='Press Start to begin!';
    hintEl.textContent='Choose the correct balloon to answer.';
    explainBox.style.display = explainToggle.checked ? 'block' : 'none';
    explainBox.textContent = '';
  }

  // Click handling
  canvas.addEventListener('click', (e)=>{
    if(!running || paused) return;
    const rect = canvas.getBoundingClientRect();
    const x = (e.clientX - rect.left) * DPR;
    const y = (e.clientY - rect.top) * DPR;
    for(let i=balloons.length-1;i>=0;i--){
      const b = balloons[i];
      const dx = x - b.x, dy = y - b.y;
      if(dx*dx + dy*dy <= b.r*b.r){
        // popped
        if(b.correct){
          b.alive = false;
          spawnConfetti(b.x,b.y,b.color);
          const base = 10 + level*2;
          streak++;
          combo = clamp(1 + Math.floor(streak/3)*0.2, 1, 3);
          const pts = Math.round(base * combo);
          score += pts;
          scoreEl.textContent = score;
          updateTags();
          showToast(`Nice! +${pts}`);
          // remove all balloons quickly
          balloons.splice(i,1);
          // also remove other balloons after a brief moment
          setTimeout(()=>{balloons = []}, 80);
        } else {
          streak = 0; combo = 1.0;
          updateTags();
          lives = Math.max(0, lives-1);
          livesEl.textContent = lives;
          showToast('Oops! -1 life');
          spawnConfetti(b.x,b.y,'#ff6b6b');
          balloons.splice(i,1);
          if(lives<=0){ endGame(false); }
        }
        break;
      }
    }
  });

  // Controls
  startBtn.addEventListener('click', ()=>{
    startGame();
  });
  pauseBtn.addEventListener('click', ()=>{
    if(!running) return;
    paused = !paused;
    pauseBtn.textContent = paused ? 'Resume' : 'Pause';
    showToast(paused ? 'Paused' : 'Go!');
  });
  resetBtn.addEventListener('click', resetGame);
  explainToggle.addEventListener('change', ()=>{
    if(explainToggle.checked){
      explainBox.style.display = 'block';
      explainBox.textContent = currentQuestion?.explain || '';
    } else {
      explainBox.style.display = 'none';
      explainBox.textContent = '';
    }
  });

})();
</script>
</body>
</html>
